on: [push]

jobs:
  k8s-manifests-debug:
    runs-on: ubuntu-latest
    name: k8s-manifests-debug
    steps:
      - uses: actions/checkout@v2
      - id: manifests-debug
        name: "⛑️ Debug Manifests ⛑️ "
        uses: ./k8s-manifests-debug
        with:
          path: ./k8s-manifests-debug/sample.yml
          token: ${{ secrets.GITHUB_TOKEN }}
      - run: |
          echo 1
          [[ -n "${{ steps.manifests-debug.outputs.markdown }}" ]] || (echo "No markdown" && exit 1)
          echo 2
          [[ -n "${{ steps.manifests-debug.outputs.text }}" ]] || (echo "No text" && exit 1)
          echo 3
          [[ -n "$JSON" == "${{ steps.manifests-debug.outputs.json }}" ]] || (echo "Different JSON :/" && exit 1)
          echo 4
      - run: |
          echo 5
          JSON='{
            "isProduction": false,
            "manifests": [
              {
                "kind": "Deployment",
                "name": "nginx-deployment"
              },
              {
                "kind": "Service",
                "name": "nginx"
              },
              {
                "kind": "Ingress",
                "name": "example-ingress"
              }
            ],
            "hosts": [
              "hello-world.info"
            ],
            "images": [
              "nginx:1.14.2"
            ]
          }'

          if [[ "${JSON}" != "${{ steps.manifests-debug.outputs.json }}" ]]; then
            echo "---"
            echo "Invalid JSON"
            echo "${JSON}"
            echo "---"
            echo "${{ steps.manifests-debug.outputs.json }}"
            echo "---"
            echo "${{ steps.manifests-debug.outputs.json }}"
            exit 1
          fi
